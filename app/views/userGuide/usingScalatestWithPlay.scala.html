@*
* Copyright 2010-2013 Artima, Inc.
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*     http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*@

@import controllers.Application.latestScaladoc

@userGuidePage("Using ScalaTest with sbt") {
<div style="text-align: left">

<h1>Using ScalaTest with Play</h1>

<p>
To use <code>ScalaTest</code> in <code>Play</code>, you first need to add a line like this to your project file:
</p>

<pre class="stGrayback">
libraryDependencies += <span class="stLiteral">"org.scalatest"</span> % <span class="stLiteral">"scalatest_2.10"</span> % <span class="stLiteral">"2.0"</span> % <span class="stLiteral">"test"</span>
</pre>

<h2>ScalaTest Support Classes</h2>

<p>
You can download the following support classes and include them in your test source:
</p>

<ul>
  <li><a href="https://github.com/scalatest/scalatest-play/blob/master/test/ScalaTestSupport.scala">ScalaTestSupport</a></li>
  <li><a href="https://github.com/scalatest/scalatest-play/blob/master/test/UnitSpec.scala">UnitSpec</a></li>
  <li><a href="https://github.com/scalatest/scalatest-play/blob/master/test/IntegrationSpec.scala">IntegrationSpec</a></li>
</ul>

<h2>Writing Unit Tests</h2>

<p>
You can use <code>UnitSpec</code> and <code>withApplication</code> method to write your unit tests, here's an example:
</p>

<pre class="stHighlighted">
<span class="stImport">import play.api.test._
import play.api.test.Helpers._</span>

<span class="stReserved">class</span> <span class="stType">ExampleUnitSpec</span> <span class="stReserved">extends</span> <span class="stType">UnitSpec</span> {

  <span class="stLiteral">"Application"</span> should {

    <span class="stLiteral">"send 404 on a bad request"</span> in {
      withApplication() {
        route(<span class="stType">FakeRequest</span>(GET, <span class="stLiteral">"/boum"</span>)) shouldBe <span class="stType">None</span>
      }
    }

    <span class="stLiteral">"render the index page"</span> in {
      withApplication() {
        <span class="stReserved">val</span> home = route(<span class="stType">FakeRequest</span>(GET, <span class="stLiteral">"/"</span>)).get

        status(home) should equal (OK)
        contentType(home) shouldBe <span class="stType">Some</span>(<span class="stLiteral">"text/html"</span>)
        contentAsString(home) should include (<span class="stLiteral">"Your new application is ready."</span>)
      }
    }
  }
}
</pre>

<p>
Alternatively, if all your tests need to be wrapped in <code>withApplication</code> call, you can download and use
<code><a href="https://github.com/scalatest/scalatest-play/blob/master/test/WithApplicationSpec.scala">WithApplicationSpec</a></code>
to eliminate the duplicated <code>withApplication</code> call:
</p>

<pre class="stHighlighted">
<span class="stImport">import play.api.test._
import play.api.test.Helpers._</span>

<span class="stReserved">class</span> <span class="stType">ExampleWithApplicationSpec</span> <span class="stReserved">extends</span> <span class="stType">WithApplicationSpec</span> {

  <span class="stLiteral">"Application"</span> should {

    <span class="stLiteral">"send 404 on a bad request"</span> in {
      route(<span class="stType">FakeRequest</span>(GET, <span class="stLiteral">"/boum"</span>)) shouldBe <span class="stType">None</span>
    }

    <span class="stLiteral">"render the index page"</span> in {
      <span class="stReserved">val</span> home = route(<span class="stType">FakeRequest</span>(GET, <span class="stLiteral">"/"</span>)).get

      status(home) should equal (OK)
      contentType(home) shouldBe <span class="stType">Some</span>("text/html")
      contentAsString(home) should include (<span class="stLiteral">"Your new application is ready."</span>)
    }

  }

}
</pre>

<h2>Writing Integration Tests</h2>

<p>
You can use <code>IntegrationSpec</code> and <code>withBrowser</code> method to write your integration tests, here's an example:
</p>

<pre class="stHighlighted">
<span class="stReserved">class</span> <span class="stType">ExampleIntegrationSpec</span> <span class="stReserved">extends</span> <span class="stType">IntegrationSpec</span> {

  <span class="stLiteral">"Application"</span> should {

    <span class="stLiteral">"work from within a browser"</span> in {
      withBrowser() { port =>
        go to (<span class="stLiteral">"http://localhost:"</span> + port)
        pageSource should include (<span class="stLiteral">"Your new application is ready."</span>)
      }
    }
  }
}
</pre>

<p>
Alternatively, if all your tests need to be wrapped in <code>withBrowser</code> call, you can download and use
<code><a href="https://github.com/scalatest/scalatest-play/blob/master/test/WithBrowserSpec.scala">WithBrowserSpec</a></code>
to eliminate the duplicated <code>withBrowser</code> call:
</p>

<pre class="stHighlighted">
<span class="stReserved">class</span> <span class="stType">ExampleWithBrowserSpec</span> <span class="stReserved">extends</span> <span class="stType">WithBrowserSpec</span> {

  <span class="stLiteral">"Application"</span> should {

    <span class="stLiteral">"work from within a browser"</span> in { port =>
      go to (<span class="stLiteral">"http://localhost:"</span> + port)
      pageSource should include (<span class="stLiteral">"Your new application is ready."</span>)
    }
  }

}
</pre>

<h2>Running Test Server</h2>

<p>
When you need to test the real HTTP stack from with your test, you can use <code>withServer</code> method:
</p>

<pre class="stHighlighted">
<span class="stImport">import play.api.libs.ws.WS
import play.api.test.Helpers._</span>

<span class="stReserved">class</span> <span class="stType">ExampleTestServerSpec</span> <span class="stReserved">extends</span> <span class="stType">IntegrationSpec</span> {

  <span class="stLiteral">"Application"</span> should {

    <span class="stLiteral">"work from within a browser"</span> in {
      withServer() { port =>
        <span class="stLineComment">// await is from play.api.test.FutureAwaits</span>
        <span class="stReserved">val</span> response = await(<span class="stType">WS</span>.url(<span class="stLiteral">"http://localhost:"</span> + port + <span class="stLiteral">"/boum"</span>).get())
        response.status shouldBe <span class="stLiteral">404</span>
      }
    }
  }
}
</pre>

<p>
Alternatively, if all your tests need to be wrapped in <code>withServer</code> call, you can download and use
<code><a href="https://github.com/scalatest/scalatest-play/blob/master/test/WithServerSpec.scala">WithServerSpec</a></code>
to eliminate the duplicated <code>withServer</code> call:
</p>

<pre class="stHighlighted">
<span class="stImport">import play.api.libs.ws.WS
import play.api.test.Helpers._</span>

<span class="stReserved">class</span> <span class="stType">ExampleWithServerSpec</span> <span class="stReserved">extends</span> <span class="stType">WithServerSpec</span> {

  <span class="stLiteral">"TestServer"</span> should {

    <span class="stLiteral">"send 404 on a bad request"</span> in { port =>
      <span class="stLineComment">// await is from play.api.test.FutureAwaits</span>
      <span class="stReserved">val</span> response = await(<span class="stType">WS</span>.url(<span class="stLiteral">"http://localhost:"</span> + port + <span class="stLiteral">"/boum"</span>).get())
      response.status shouldBe <span class="stLiteral">404</span>
    }

  }
}
</pre>

<h2>Testing a Template</h2>

<p>
You can test a template as a standard Scala function:
</p>

<pre class="stHighlighted">
<span class="stLiteral">"render index template"</span> in {
  <span class="stReserved">val</span> html = views.html.index(<span class="stLiteral">"ScalaTest 2.0 released!"</span>)

  contentType(html) shouldBe (<span class="stLiteral">"text/html"</span>)
  contentAsString(html) should include (<span class="stLiteral">"ScalaTest 2.0"</span>)
}
</pre>

<h2>Testing a Controller</h2>

<p>
You can test a controller action by providing a <code>FakeRequest</code>:
</p>

<pre class="stHighlighted">
<span class="stLiteral">"respond to the index Action"</span> in {
  <span class="stReserved">val</span> result = controllers.<span class="stType">Application</span>.index()(<span class="stType">FakeRequest</span>())

  status(result) should equal (OK)
  contentType(result) shouldBe <span class="stType">Some</span>(<span class="stLiteral">"text/html"</span>)
  charset(result) shouldBe <span class="stType">Some</span>(<span class="stLiteral">"utf-8"</span>)
  contentAsString(result) should include (<span class="stLiteral">"Your new application is ready."</span>)
}
</pre>

<h2>Testing a Router</h2>

<p>
You can test the <code>Router</code> by calling <code>route</code> method:
</p>

<pre class="stHighlighted">
<span class="stLiteral">"respond to the index Action"</span> in {
  withApplication() {
    <span class="stReserved">val</span> <span class="stType">Some</span>(result) = route(<span class="stType">FakeRequest</span>(GET, <span class="stLiteral">"/Bob"</span>))

    status(result) should equal (OK)
    contentType(result) shouldBe <span class="stType">Some</span>(<span class="stLiteral">"text/html"</span>)
    charset(result) shouldBe <span class="stType">Some</span>(<span class="stLiteral">"utf-8"</span>)
    contentAsString(result) should include (<span class="stLiteral">"Hello Bob"</span>)
  }
}
</pre>

<h2>Testing a model</h2>

<p>
You can use <code>inMemoryDatabase</code> method to test your database and model code:
</p>

<pre class="stHighlighted">
<span class="stReserved">val</span> appWithMemoryDatabase = <span class="stType">FakeApplication</span>(additionalConfiguration = inMemoryDatabase(<span class="stLiteral">"test"</span>))
<span class="stLiteral">"run an application"</span> in {
  withApplication(appWithMemoryDatabase) {
    <span class="stReserved">val</span> <span class="stType">Some</span>(macintosh) = <span class="stType">Computer</span>.findById(<span class="stLiteral">21</span>)

    macintosh.name should equal (<span class="stLiteral">"Macintosh"</span>)
    macintosh.introduced shouldBe <span class="stType">Some</span>(<span class="stLiteral">"1984-01-24"</span>)
  }
}
</pre>

</div>
}
